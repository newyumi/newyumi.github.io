---
layout: post
title: "영원한 컴퓨터 개발자의 숙제 동기/비동기 "
subtitle: "#async #promise"
type: "I am struggling to solve the problem."
development: true
text: true
author: "Yumi Yang"
post-header: false
header-img: "async/images/header.jpg"
order: 3
date: 2019-05-16
comments: true
---

💻 구현해야 하는 로직

1. 하나의 센서의 현재 측정값을 불러오는 API가 있다.
2. 세 개의 센서의 값을 합쳐야해서 (3상) 이 API를 세 번 호출해서 하나의 값으로 계산해야 한다.
3. 이러한 세트가 10개 정도 있고, 이걸 거의 동시에 뿌려줘야 한다.
4. 2,3번을 1분 마다 반복해야 한다.

<br/><br/>

📕 현재 상태<br/>
예전 프로젝트 기반의 한 페이지의 일이라 그 때 환경을 그대로 사용
`ES2015` `Angularjs 1.7.8v` `async await 예약어가 없다`

1. 하나의 센서의 현재 측정값을 불러오는 API가 있다. `=> 콜백 호출`
2. 세 개의 센서의 값을 합쳐야해서 (3상) 이 API를 세 번 호출해서 하나의 값으로 계산해야 한다.
   `=> 각각을 프로미스 객체로 만들어서 Angularjs에서 제공하는, $q.all을 사용해서 3개의 호출 값을 배열로 한번에 받아
값을 더해주었다.`
3. 이러한 세트가 10개 정도 있고, 이걸 거의 동시에 뿌려줘야 한다.
   `오랜 삽질 후에 bluebird 모듈을 사용해서 delay를 주어 임시방편으로 문제를 해결하였다.`
4. 2,3번을 2분 마다 반복해야 한다.
   `3번을 interval을 주어 2분마다 반복 실행하였다.`

<br/><br/>

여기서 문제는 3번이다.
여러가지 방법으로 시도하면서 새로운 것을 알게 되었는데, 처음에 단순하게 interval로 함수를 실행해서 delay를 줘볼까 했었다.
그런데 지정해준 시간 뒤에 실행된다기 보다는 맨 처음 선언이 되면서 함수를 호출하지만 결과값이 늦게 나온다고 해야하나.
좋은 방법도 아니었지만 실행도 못하고 에러가 났다.
그리고 다시 프로미스 객체로 선언했는데, 이 것 역시 선언해주면서 함수가 실행되어 버려서 위와 같은 결과였다.
이 에러의 내용은 콜백 함수가 너무 빨리 호출이 되어버린다는 것이다.
같은 작업인데도 어떤 때는 동기적으로 어떤 때는 비동기적으로 실행이 되어버려서 에러가 생겼다.
비동기 호출은 일단 처음부터 순서를 잘 잡아야 하는데, 2번과 3번이 함께 비동기로 호출될 때 순서가 잘 맞지 않는것이 문제였다.
<br/><br/>
이 때 디버깅 하면서 하면 디버깅 때문에 순서대로 천천히 호출이 되어버려서 에러가 나지 않는다.
그래서 로그를 찍어가면서 실행을 해봤다.<br/>
문제 해결의 열쇠는 혹시 다른 쓰레드간에 race condition인 변수는 없는지 보는것.
그리고 map 함수와 람다를 활용해보는것.
3번의 두번째 함수를 실행하기 전에 첫번째 함수가 모두 끝나길 기다리는 함수를 쓰는것. (delay가 아니라 끝남을 확인)
다 끝나고 트리거되는 또 다른 비동기 함수를 만들것. (선배가 말하길)
아직 해결은 못했다.
해결되는대로 다시 ㄱㄱ
<br/><br/>
